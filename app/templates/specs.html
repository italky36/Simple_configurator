{% extends "base.html" %}
{% block title %}Характеристики{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Характеристики устройств</h2>
    <div class="d-flex gap-2">
        <div class="btn-group">
            <button class="btn btn-outline-secondary" id="populate-specs-btn">Заполнить из таблицы</button>
            <button class="btn btn-danger" id="bulk-delete-specs" disabled>Удалить выбранные</button>
            <button class="btn btn-primary" id="add-spec-btn">Добавить</button>
        </div>
    </div>
  </div>
<div class="table-responsive">
    <table class="table table-striped table-sm small" id="specs-table">
        <thead>
            <tr>
                <th style="width:32px;"><input type="checkbox" id="select-all-specs"></th>
                <th>Имя</th>
                <th>Характеристики</th>
                <th style="width:140px;">Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for spec in specs %}
            <tr data-spec='{{ {
                "id": spec.id,
                "category": spec.category,
                "name": spec.name,
                "specs_text": spec.specs_text or "",
                "description": spec.description or ""
            } | tojson | safe }}'>
                <td><input type="checkbox" class="spec-row-select" data-id="{{ spec.id }}"></td>
                <td>
                    <div class="fw-semibold">{{ spec.name }}</div>
                    <div class="text-muted small">{{ spec.category }}</div>
                </td>
                <td class="text-break" style="max-width: 360px; white-space: pre-line;">{{ spec.specs_text or "-" }}</td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <button class="btn btn-outline-secondary btn-spec-edit">Редактировать</button>
                        <button class="btn btn-outline-danger btn-spec-delete">Удалить</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Spec modal -->
<div class="modal fade" id="specModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="spec-form">
        <div class="modal-header">
          <h5 class="modal-title">Характеристика</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id" id="spec-id">
          <div class="mb-3">
            <label class="form-label">Категория *</label>
            <input type="text" class="form-control" name="category" required placeholder="coffee_machine / terminal / refrigerator">
          </div>
          <div class="mb-3">
            <label class="form-label">Имя (уникальное) *</label>
            <input type="text" class="form-control" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Характеристики (каждая с новой строки)</label>
            <textarea class="form-control" rows="6" name="specs_text" placeholder="пункт 1&#10;пункт 2"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
          <button type="submit" class="btn btn-primary">Сохранить</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
